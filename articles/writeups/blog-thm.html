<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Writeup (THM)</title>
    <link rel="stylesheet" href="../../style/styles.css">
    <link rel="stylesheet" href="model.css"">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <main>
        <article class="article-container">
            <div class="article-header">
                <h1 class="article-title">Blog - THM</h1>
                <div class="article-meta">
                    <span class="article-tags">
                        <i class="fas fa-tags"></i>
                        <span class="tag">Web Application</span>
                        <span class="tag">Linux</span>
                        <span class="tag">Reverse Engineering</span>
                        <span class="tag">THM</span>
                    </span>
                    <span class="article-date"><i class="far fa-calendar"></i> 27 de Outubro, 2025</span>
                </div>
            </div>

                    <div class="article-content">
            <h2>Introduction</h2>
            <p>
                Difficulty: Medium<br>
                Machine: Blog<br>
                IP Address: 10.10.81.137
            </p>
            <p>We started the operation by running an nmap scan</p>
            
            <img src="./assets/blog/1.jpg" alt="">

            <p>In the scan, we found 4 open ports, but 2 caught my attention: one running SMB and another running a web server.</p>
            <img src="./assets/blog/2.jpg" alt="">
            <p>I take a look at the site initially to see its features, but since I already know what the CTF is about, I go straight to the WordPress page, which is a very popular CMS. CMSs are programs used to help organize web applications, they handle structure, manage features, etc, and are widely used.</p>
            <img src="./assets/blog/3.jpg" alt="">
            <p>But they also come with certain vulnerabilities. Anyway, I explore the application thoroughly and find a few things, but nothing very useful. I then decide to enumerate using a WordPress-specific tool, "WPScan".</p>
            <img src="./assets/blog/4.jpg" alt="">
            <p>Running that tool, I was able to discover some interesting information, but even more interesting was when it enumerated users who have admin accounts in the WordPress panel.</p>
            <img src="./assets/blog/5.jpg" alt="">
            <p>After discovering two valid users, we started a bruteforce attack on both, using WPScan itself.</p>
            <img src="./assets/blog/6.jpg" alt="">
            <p>After a while, I discovered the password for the user "kwheel", which allowed me to access the WordPress admin panel. There, I poked around and tried a few things, but without success.</p>
            <img src="./assets/blog/7.jpg" alt="">
            <p>So I did some research. I saw that the WordPress version was 5.0 and searched for vulnerabilities in that version, eventually finding one that existed in Metasploit.</p>
            <img src="./assets/blog/8.jpg" alt="">
            <p>With the exploit in hand, it's just a matter of configuring a few things and executing it.</p>
            <img src="./assets/blog/9.jpg" alt="">
            <p>After obtaining remote access to the target machine, we can now begin internal exploitation to try to elevate our privileges and gain full control of the machine.</p>
            <img src="./assets/blog/10.jpg" alt="">
            <p>I start rummaging through some folders looking for potentially interesting files, when I remember there's an SMB server (a file sharing server), so I go after it to see what's inside.</p>
            <img src="./assets/blog/11.jpg" alt="">
            <p>I can access and retrieve images and videos from the server, but there was nothing useful, just a rabbit hole. Back on the main machine, I decide to look for specific files on the system that run with elevated privileges, during this search I find something that caught my attention.</p>
            <img src="./assets/blog/12.jpg" alt="">
            <p>A binary file with SUID enabled. I then ran it to see what it did.</p>
            <img src="./assets/blog/13.jpg" alt="">
            <p>
                We see that, apparently, you need to be an "admin" for it to function correctly, however, it's always good to analyze things thoroughly, and that's what I did. There are other options to analyze this file, some even easier/simpler, but I chose to use Ghidra, a specialized tool for analyzing executables and performing reverse engineering.
                <br><br>
                In Ghidra, I was able to understand how this file was programmed: it actually checked whether the user had the environment variable "admin" set to "true", or "1". To summarize, the program verifies if you are admin by only looking at the label on your jacket, and it does not validate your identity.
            </p>
            <img src="./assets/blog/14.jpg" alt="">
            <p>Understanding how the executable works and its flaw, I could take advantage of it by changing the environment variables, thus creating my answer to this weak check. If I didn't have the label before, I just stuck it on my jacket now.</p>
            <img src="./assets/blog/15.jpg" alt="">
            <p>Finally, I run it again and that's it, root acquired successfully!</p>
        </div>

        <div class="article-footer">
            <a href="../../index.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to the start</a>
        </div>
    </article>
</main>

<footer>
    <div class="social-links">
        <a href="https://github.com/lsbxa" target="_blank"><i class="fab fa-github"></i></a>
        <a href="https://www.linkedin.com/in/marcelolisboa7/" target="_blank"><i class="fab fa-linkedin"></i></a>
    </div>
    <p>&copy; 2025 Memory Leak</p>
</footer>
    <div id="imageModal" class="image-modal">
    <span class="image-modal-close">&times;</span>
    <img id="modalImage" src="" alt="">
</div>

<script>
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const closeBtn = document.querySelector('.image-modal-close');
    const images = document.querySelectorAll('.article-content img');

    images.forEach(img => {
        img.addEventListener('click', function() {
            modal.classList.add('active');
            modalImg.src = this.src;
        });
    });

    closeBtn.addEventListener('click', () => {
        modal.classList.remove('active');
    });

    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.remove('active');
        }
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            modal.classList.remove('active');
        }
    });
</script>
</body>

</html>

